#! /bin/bash

bold=$(tput bold)
normal=$(tput sgr0)

bold_echo() {
  echo "${bold}$1${normal}" 
}

announce() {
  echo
  bold_echo "$1"
}

deleted_branches() {
  git branch -vv --no-color | grep ': gone]'|  grep -v "\*" | awk '{ print $1; }'
}

announce "Cleaning up local branches merged upstream..."

announce "-> Switching to main branch"
git switch main

announce "-> Updating local main branch from origin, removing refs to deleted remote branches"
git pull origin --prune

announce "-> Deleting merged local branches removed from origin"
if [[ $1 == "--force" || $1 == "-f" ]]; then
  deleted_branches | xargs -r git branch -D
else
  deleted_branches | xargs -r git branch -d
fi

announce "-> Putting you back where you were"
git switch -

announce "DONE!"
