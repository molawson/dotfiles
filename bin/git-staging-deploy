#! /bin/bash

bold=$(tput bold)
normal=$(tput sgr0)

boldEcho() {
  echo "${bold}$1${normal}" 
}

if [ -z "$(git status --porcelain)" ]; then 
  echo
  boldEcho "Deploying current branch to staging..."
  echo
  boldEcho "-> Updating local staging branch"
  git switch staging
  git pull origin
  echo
  boldEcho "-> Merging current branch into staging"
  git merge --commit --no-edit -
  echo
  boldEcho "-> Pushing to staging"
  git push origin
  echo
  boldEcho "-> Switching back to original branch"
  git switch -
  echo
  boldEcho "DONE!"
  echo
else 
  boldEcho "You have changes in your working directory."
  boldEcho "Commit or stash them before running this command."
  exit 1
fi
